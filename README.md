# 相対強度とチャートパターンに基づく株式スクリーニングエンジン

## 概要

このプロジェクトは、米国および日本市場における潜在的な取引機会を特定するために設計された、包括的な株式スクリーニングおよび分析エンジンです。IBDやマーク・ミネルヴィニによって広められた相対強度（RS）の概念と、古典的なテクニカルチャートパターンの自動検出を組み合わせて活用します。

このエンジンは、体系的に株式をフィルタリングし、そのモメンタムを計算し、強力な上昇トレンドを特定し、特定の買いシグナルパターンを検出し、有望な候補のチャートとシグナルリストを生成します。

## 主な機能

- **相対強度（RS）計算**: マンスフィールド流の相対強度レーティングを実装し、各株式のパフォーマンスを市場全体と比較します。個別株と市場セクターの両方のRSを計算します。
- **テクニカルパターン認識**: 以下を含む、さまざまな強気のチャートパターンを自動的にスクリーニングします。
    - マーク・ミネルヴィニのトレンドテンプレート（ほとんどのシグナルの前提条件）
    - ボラティリティ収縮パターン（VCP）
    - カップウィズハンドル
    - ダブルボトム
    - フラットベース
    - グランビルの法則による買いシグナル
    - ゴールデンクロス（MA50/MA150、MA150/MA200）
- **ファンダメンタルズ・スクリーニング**: テクニカル分析を実行する前に、候補銘柄の基本的なファンダメンタルズチェックを実行します。
- **自動チャート作成**: 有効な買いシグナルごとに詳細な株価チャートを生成・保存し、パターン、主要な価格水準、Up/Downボリュームレシオや相対強度データなどの関連情報を注釈付けします。
- **日米市場のサポート**: 米国（`US_*.sh`, `*US.py`）と日本（`JP_*.sh`, `*JP.py`）の両方の株式市場を分析するための、個別の並列スクリプトとデータファイルが含まれています。

## ワークフロー

分析プロセスは、一連のスクリプトによって自動化されており、以下の順序で動作します。

1.  **ティッカーリストの生成 (`getList_*.py`)**: 各取引所（例：日本の場合はJPX）から上場企業全社の最新リストを取得することからプロセスが始まります。このリストは、超小型株や流動性の低い株を除外するためにフィルタリングされます。
2.  **相対強度（RS）データの計算 (`relative-strength-*.py`)**: フィルタリングされたティッカーリストがRSエンジンに渡されます。各銘柄の過去の株価データをダウンロードし、RSレーティング（1～99のパーセンタイルランク）を計算します。また、各市場セクターの平均RSも計算します。結果はCSVファイル（`_files/RS/`）に保存されます。
3.  **スクリーニングとシグナル生成 (`chkData.py`)**: これが分析の中核となるスクリプトです。ティッカーリストをループ処理し、2段階のスクリーニングを実行します。
    - **ステージ1（ファンダメンタルズ）**: ファンダメンタルズの簡単なチェック。通過しない銘柄はスキップされます。
    - **ステージ2（テクニカル）**: ファンダメンタルズに問題がなければ、その銘柄がトレンドテンプレートの基準を満たしているか確認します。満たしている場合は、より具体的な買いパターン（VCP、カップウィズハンドルなど）のチェックに進みます。
4.  **実行管理 (`*.sh` スクリプト)**: シェルスクリプト（`US_Daily.sh`, `JP_Weekly.sh`など）がワークフロー全体を管理し、Pythonスクリプトを正しい順序と必要なパラメータで実行します。

## プロジェクト構成

```
.
├── US_Daily.sh             # 米国市場の日次分析を実行するメインスクリプト
├── JP_Daily.sh             # 日本市場の日次分析を実行するメインスクリプト
├── getList_US.py           # 米国のティッカーリストを取得・フィルタリング
├── getList_JP.py           # 日本のティッカーリストを取得・フィルタリング
├── relative-strength-us.py # 米国株とセクターのRSを計算
├── relative-strength-jp.py # 日本株とセクターのRSを計算
├── RelativeStrength.py     # RS計算ロジックのコアライブラリ
├── chkData.py              # メインのスクリーニングエンジン（ファンダメンタル＆テクニカル）
├── classCheckData.py       # 全てのテクニカルパターンロジックを含むクラス
├── classDrawChart.py       # チャートを生成・保存するためのクラス
├── classEarningsInfo.py    # ファンダメンタルデータチェック用のクラス
├── _files/RS/              # RSデータCSVを保存するディレクトリ
│   ├── rs_stocks_us.csv
│   └── rs_industries_us.csv
└── ...
```

## 実行方法

エンジンを実行する主な方法は、シェルスクリプトを実行することです。

```bash
# 米国市場の日次分析を実行
./US_Daily.sh

# 日本市場の週次分析を実行
./JP_Weekly.sh
```

**注意**: スクリプトにはハードコードされたパス（例：`/content/drive/My Drive/Screening/`）が含まれています。自身のディレクトリ構造や環境に合わせて、これらのスクリプトやPythonファイルを編集する必要があるでしょう。

## 依存関係

このプロジェクトは、以下のPythonライブラリに依存しています。

- `pandas`
- `yfinance`
- `requests`
- `pytz`

pipを使用してインストールできます。

```bash
pip install pandas yfinance requests pytz
```
